---

- hosts: all
  tasks:

  - name: Install Ansible dependancies
    package:
      name: "{{ item }}"
      state: latest
    with_items:
      - python3-firewall
    become: true

  - name: Install mDNS software
    package:
      name: "{{ item }}"
      state: latest
    with_items:
      - avahi
      - nss-mdns
    become: true
    notify: Restart Avahi

  - name: Open firewall ports for mDNS and ssh
    firewalld:
      service: "{{ item }}"
      permanent: true
      immediate: true
      state: enabled
    with_items:
      - ssh
      - mdns
    become: true

  - name: Enable and Start Avahi
    service:
      name: avahi-daemon
      enabled: yes
      state: started
    become: true

  handlers:
  - name: Restart Avahi
    service:
      name: avahi-daemon
      state: restarted
    become: true